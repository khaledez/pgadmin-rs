{% extends "base.html" %}

{% block title %}Schema Browser - pgAdmin-rs{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>Schema Browser</h2>
        <p class="text-sm text-muted mt-md">Navigate your database structure</p>
    </div>

    <div class="flex gap-lg">
        <!-- Schema List -->
        <div style="flex: 0 0 300px;">
            <h3 class="mb-md">Schemas</h3>
            <div id="schema-list"
                 hx-get="/api/schemas"
                 hx-trigger="load"
                 hx-indicator="#schema-spinner">
                <div class="spinner" id="schema-spinner"></div>
                <p class="text-muted">Loading schemas...</p>
            </div>
        </div>

        <!-- Table List -->
        <div style="flex: 0 0 300px;">
            <h3 class="mb-md">Tables</h3>
            <div id="table-list">
                <p class="text-muted">Select a schema to view its tables.</p>
            </div>
        </div>

        <!-- Table Details -->
        <div style="flex: 1;">
            <div id="table-data-container">
                <p class="text-muted">Select a table to view details.</p>
            </div>
        </div>
    </div>
</div>

<script>
    // Handle schema selection via HTMX
    document.body.addEventListener('htmx:afterSettle', function(evt) {
        // If schema list was just loaded
        if (evt.detail.target.id === 'schema-list') {
            document.querySelectorAll('.schema-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const schema = this.dataset.schema;
                    htmx.ajax('GET', `/api/schemas/${schema}/tables`, '#table-list', {
                        swap: 'innerHTML'
                    });
                });
            });
        }
    });
</script>
{% endblock %}
